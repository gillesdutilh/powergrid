<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>powergrid • powergrid</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="powergrid">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">powergrid</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/powergrid.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/SwissClinicalTrialOrganisation/powergrid/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>powergrid</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/SwissClinicalTrialOrganisation/powergrid/blob/main/vignettes/powergrid.Rmd" class="external-link"><code>vignettes/powergrid.Rmd</code></a></small>
      <div class="d-none name"><code>powergrid.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/SwissClinicalTrialOrganisation/powergrid" class="external-link">powergrid</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The powergrid package is made to facilitate the exploration of
statistical power of a study. In a typical use case (also shown in this
vignette) you want to explore how sample size, the effect size of
interest and the assumed variability of the data influence the power of
your planned analysis.</p>
<p>This package does not dictate any of the above ingredients for you.
It just allows you to evaluate a function at a grid of parameters and
visualize the interrelation in plots that are fine-tuned for analyses of
power and sample size.</p>
<p>You may, however use powergrid for very different purposes. An
example close to a power analysis would be an analysis of the precision
you may expect of a study design. As a more remote application, you can
think of a coverage study for different methods to calculate confidence
intervals. Or an exploration for planning recruitment of study
participants under various scenarios.</p>
<div class="section level3">
<h3 id="functions-covered">Functions covered<a class="anchor" aria-label="anchor" href="#functions-covered"></a>
</h3>
<p>This vignette covers the following functions of
<code>powergrid</code></p>
<ul>
<li>
<code>PowerGrid</code> for evaluating the power across a grid, with
and without iterations</li>
<li>
<code>Example</code> for inspecting the relation between power and
sample size in a specific scenario</li>
<li>
<code>Powerplot</code> Graphical exploration of power under
different scenarios</li>
<li>
<code>GridPlot</code> Graphical exploration of power under even more
scenarios</li>
<li>
<code>AddExample</code> Add an example to an existing PowerPlot or
GridPlot</li>
<li>
<code>FindTarget</code> For a range of parameters, searching along
one other parameter for a setting yielding a target power (or other
value)</li>
</ul>
</div>
<div class="section level3">
<h3 id="outline">Outline<a class="anchor" aria-label="anchor" href="#outline"></a>
</h3>
<p>In the next section, I start by showing a technical example that
should illustrate the essence of PowerGrid and FindTarget. Then, in the
third section, I show 4 actual use cases exploiting the flexibility of
powergrid.</p>
</div>
</div>
<div class="section level2">
<h2 id="technical-example">Technical example<a class="anchor" aria-label="anchor" href="#technical-example"></a>
</h2>
<p>Before turning to a real-world example, I show an example
illustrating general working of the core functions of powergrid:
PowerGrid and FindTarget. Note that you will hardly ever explicitly call
FindTarget.</p>
<p>PowerGrid is in essence similar to <code>tapply</code> (or
<code>dplyr::group_by1</code> + <code>dplyr::summarise</code>).
FindTarget is in essence a combination of <code>apply</code> +
<code>match</code> + <code>min</code> + <code>which.min</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## I aim to create an array with the product of three numbers</span></span>
<span></span>
<span><span class="co">## A function taking the product of three numbers:</span></span>
<span><span class="va">Prod</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">z</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">*</span> <span class="va">y</span> <span class="op">*</span> <span class="va">z</span></span>
<span><span class="op">}</span></span>
<span><span class="co">## A grid of numbers I want to calculate the products of. Note that the names of</span></span>
<span><span class="co">## the list equal the argument names in Prod()</span></span>
<span><span class="va">par</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,</span>
<span>           y <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,</span>
<span>           z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">products</span> <span class="op">=</span> <span class="fu"><a href="../reference/PowerGrid.html">PowerGrid</a></span><span class="op">(</span><span class="va">par</span>, <span class="va">Prod</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">products</span><span class="op">)</span></span>
<span><span class="co">#&gt; , , z = 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     y</span></span>
<span><span class="co">#&gt; x      1   2   3</span></span>
<span><span class="co">#&gt;   1    1   2   3</span></span>
<span><span class="co">#&gt;   2    2   4   6</span></span>
<span><span class="co">#&gt;   3    3   6   9</span></span>
<span><span class="co">#&gt;   4    4   8  12</span></span>
<span><span class="co">#&gt;   5    5  10  15</span></span>
<span><span class="co">#&gt;   6    6  12  18</span></span>
<span><span class="co">#&gt;   7    7  14  21</span></span>
<span><span class="co">#&gt;   8    8  16  24</span></span>
<span><span class="co">#&gt;   9    9  18  27</span></span>
<span><span class="co">#&gt;   10  10  20  30</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , z = 10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     y</span></span>
<span><span class="co">#&gt; x      1   2   3</span></span>
<span><span class="co">#&gt;   1   10  20  30</span></span>
<span><span class="co">#&gt;   2   20  40  60</span></span>
<span><span class="co">#&gt;   3   30  60  90</span></span>
<span><span class="co">#&gt;   4   40  80 120</span></span>
<span><span class="co">#&gt;   5   50 100 150</span></span>
<span><span class="co">#&gt;   6   60 120 180</span></span>
<span><span class="co">#&gt;   7   70 140 210</span></span>
<span><span class="co">#&gt;   8   80 160 240</span></span>
<span><span class="co">#&gt;   9   90 180 270</span></span>
<span><span class="co">#&gt;   10 100 200 300</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Array of class `power_array` created using</span></span>
<span><span class="co">#&gt; PowerGrid.</span></span>
<span><span class="co">#&gt;  Resulting dimensions:</span></span>
<span><span class="co">#&gt;  x, y, z.</span></span>
<span></span>
<span><span class="co">## Now, I can ask: for each combination of y and z, what is the lowest x where</span></span>
<span><span class="co">## the product is at least 20?</span></span>
<span><span class="fu"><a href="../reference/FindTarget.html">FindTarget</a></span><span class="op">(</span><span class="va">products</span>,</span>
<span>           par_to_search <span class="op">=</span> <span class="st">'x'</span>,</span>
<span>           find_lowest <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>           target_at_least <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>           target_value <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="co">#&gt;    z</span></span>
<span><span class="co">#&gt; y    1 10</span></span>
<span><span class="co">#&gt;   1 NA  2</span></span>
<span><span class="co">#&gt;   2 10  1</span></span>
<span><span class="co">#&gt;   3  7  1</span></span>
<span><span class="co">## Note: when both y and z are 1, there is no x so that the product becomes 20.</span></span></code></pre></div>
<p>If you understand the R chunk above, you understand the essence of
powergrid.</p>
<div class="section level4">
<h4 id="now-forget-about-findtarget">Now, forget about FindTarget!<a class="anchor" aria-label="anchor" href="#now-forget-about-findtarget"></a>
</h4>
<p>In typical use cases, you will use Example(), PowerPlot(), and
GridPlot() and AddExample(), which rely on FindTarget internally.</p>
</div>
</div>
<div class="section level2">
<h2 id="four-use-cases">Four use cases<a class="anchor" aria-label="anchor" href="#four-use-cases"></a>
</h2>
<p>I describe two basic use cases here, and two slightly more fancy
ones. The first two concern the relation between power, sample size, and
two further parameters. In the <a href="#ex1">first situation</a>, a
function for calculating the power is available. In the <a href="#ex2">second situation</a>, the power needs to be found through
(re-)sampling. The <a href="#ex3">third example</a> concerns a situation
where the objective is not a minimal power, but a CI-width that must be
at most a certain value. In the <a href="#ex4">fourth example</a>, we do
not search the <em>lowest required</em> sample size, but the <em>highest
permissible</em> standard deviation to achieve a target power.</p>
<div class="section level3">
<h3 id="ex1">Power and sample size for a t-test<a class="anchor" aria-label="anchor" href="#ex1"></a>
</h3>
<p>Assume we aim to collect data in a two-armed RCT and plan to perform
a simple t-test. In this situation, the situation concerning power can
be summarized in the following ingredients:</p>
<ol style="list-style-type: decimal">
<li>total sample size</li>
<li>effect size of interest</li>
<li>expected standard deviation in the study arms</li>
<li>the objective: to achieve a significant t-test</li>
</ol>
<div class="section level4">
<h4 id="calculate-and-inspect">Calculate and inspect<a class="anchor" aria-label="anchor" href="#calculate-and-inspect"></a>
</h4>
<p>I use the function <code>PowerGrid</code> to evaluate the situation
sketched above. This is done as follows</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## A function that returns the power as a function of three input parameters</span></span>
<span><span class="va">PowFun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">delta</span>, <span class="va">sd</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">ptt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/power.t.test.html" class="external-link">power.t.test</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span><span class="op">/</span><span class="fl">2</span>,</span>
<span>                     delta <span class="op">=</span> <span class="va">delta</span>,</span>
<span>                     sd <span class="op">=</span> <span class="va">sd</span>,</span>
<span>                     sig.level <span class="op">=</span> <span class="fl">0.03</span><span class="op">)</span> <span class="co"># the typical 3% alpha threshold</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">ptt</span><span class="op">$</span><span class="va">power</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">## A list of values of input parameters to study</span></span>
<span><span class="va">pars</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> <span class="co"># a normal list</span></span>
<span>  n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">10</span>, to <span class="op">=</span> <span class="fl">60</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>, <span class="co"># sample size</span></span>
<span>  delta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0.5</span>, to <span class="op">=</span> <span class="fl">1.7</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>, <span class="co"># effect size</span></span>
<span>  sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">.5</span>, <span class="fl">1</span>, <span class="fl">.1</span><span class="op">)</span> <span class="co"># variability</span></span>
<span><span class="op">)</span></span>
<span><span class="co">## Apply PowFun to all crossings of the parameters in pars</span></span>
<span><span class="va">power</span> <span class="op">=</span> <span class="fu"><a href="../reference/PowerGrid.html">PowerGrid</a></span><span class="op">(</span>pars <span class="op">=</span> <span class="va">pars</span>, fun <span class="op">=</span> <span class="va">PowFun</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">power</span><span class="op">)</span></span>
<span><span class="co">#&gt;  Object of class: power_array</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Range of values: [0.07, 1] </span></span>
<span><span class="co">#&gt;  Evaluated at:</span></span>
<span><span class="co">#&gt;       n 10, 15, 20, 25, 30, 35, 40, 45, 50, 55, 60</span></span>
<span><span class="co">#&gt;   delta 0.5, 0.6, 0.7, 0.8, 0.9, 1, 1.1, 1.2, 1.3, 1.4,</span></span>
<span><span class="co">#&gt;   delta 1.5, 1.6, 1.7</span></span>
<span><span class="co">#&gt;      sd 0.5, 0.6, 0.7, 0.8, 0.9, 1</span></span>
<span><span class="fu"><a href="../reference/PowerPlot.html">PowerPlot</a></span><span class="op">(</span><span class="va">power</span>,</span>
<span>          slicer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sd <span class="op">=</span> <span class="fl">.7</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="powergrid_files/figure-html/basic%20PowerGrid-1.png" width="550" style="display: block; margin: auto;"></p>
<p>In the code above, note that the names of the elements in the list
<code>pars</code> match the names of the function arguments in PowFun.
This is a requirement for PowerGrid to work.</p>
</div>
<div class="section level4">
<h4 id="focus-on-an-example-situation">Focus on an example situation<a class="anchor" aria-label="anchor" href="#focus-on-an-example-situation"></a>
</h4>
<p>Now, say, you want to be pretty sure (say, power = 90%) to detect an
effect size as small as 1.1, and the best guess for SD = .7. We can
calculate this example:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/Example.html">Example</a></span><span class="op">(</span><span class="va">power</span>,</span>
<span>        example <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>delta <span class="op">=</span> <span class="fl">1.1</span>, sd <span class="op">=</span> <span class="fl">.7</span><span class="op">)</span>,</span>
<span>        target_value <span class="op">=</span> <span class="fl">.9</span><span class="op">)</span> <span class="co"># power = 90%</span></span>
<span><span class="co">#&gt; ================================================</span></span>
<span><span class="co">#&gt; To achieve the target value of at most 0.9 assuming</span></span>
<span><span class="co">#&gt; delta = 1.1</span></span>
<span><span class="co">#&gt; sd = 0.7,</span></span>
<span><span class="co">#&gt; the minimal required n = 25</span></span>
<span><span class="co">#&gt; ------------------------------------------------</span></span>
<span><span class="co">#&gt; Description: Method "step" was used to find the</span></span>
<span><span class="co">#&gt; lowest n in the searched grid that yields a</span></span>
<span><span class="co">#&gt; target_value (typically power) of at least 0.9.</span></span>
<span><span class="co">#&gt; ================================================</span></span></code></pre></div>
<div class="section level5">
<h5 id="draw-a-figure-with-example">Draw a figure with example<a class="anchor" aria-label="anchor" href="#draw-a-figure-with-example"></a>
</h5>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/PowerPlot.html">PowerPlot</a></span><span class="op">(</span><span class="va">power</span>,</span>
<span>          slicer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sd <span class="op">=</span> <span class="fl">.7</span><span class="op">)</span>,</span>
<span>          example <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>delta <span class="op">=</span> <span class="fl">1.1</span><span class="op">)</span>,</span>
<span>          target_value <span class="op">=</span> <span class="fl">.9</span></span>
<span>          <span class="op">)</span></span></code></pre></div>
<p><img src="powergrid_files/figure-html/basic%20PowerPlot-1.png" width="550" style="display: block; margin: auto;"></p>
<p>Some things to note in the figure code:</p>
<ul>
<li>You need to “slice out” one plain from your power_array. In this
case, this the slice where <code>sd = .9</code>. The slice has the form
of the figure: delta by n.</li>
<li>Note that the example is a bit above the power = 90% line. This is
because of the resolution of parameter n: at the example value of delta,
the arrow points at the lowest n in pars, for which the power is at
least 90%.</li>
<li>You could also slice out a plain where <code>delta = .8</code> and
show how the relation between power and n depends on the standard
deviation. Or slice out a plain where <code>n = 50</code>, and see how
power behaves as a function of delta and sd.</li>
<li>You can add additional examples, either by increasing the the length
of the vector in the argument to example, (e.g.,
<code>example = list(delta = c(1, 1.2)))</code> or by using the higher
level plotting function <code>AddExample</code>. The latter allows you
more flexibility, like setting different colors or line types.</li>
<li>There are many options in PowerPlot and AddExample that you may want
to learn about in the help files.</li>
</ul>
</div>
<div class="section level5">
<h5 id="why-target-not-power">Why target, not power?<a class="anchor" aria-label="anchor" href="#why-target-not-power"></a>
</h5>
<p>The wording “target_value” in both the function argument and the
printed result may be a bit confusing at first. ‘Why not “power”?’, you
may ask. The reason is, that there is nothing that keeps you from
optimizing other things with the functionality of
<code>powergrid</code>. Indeed, instead of finding a target power, you
may be looking for a target precision.</p>
</div>
</div>
<div class="section level4">
<h4 id="more-elaborate-exploration-of-power">More elaborate exploration of power<a class="anchor" aria-label="anchor" href="#more-elaborate-exploration-of-power"></a>
</h4>
<p>The PowerPlot already gives some insight into how the relation
between sample size and power depends on a third parameter, effect size.
Now, GridPlot offers a figure to explore one extra parameter.</p>
<div class="section level5">
<h5 id="gridplot">GridPlot<a class="anchor" aria-label="anchor" href="#gridplot"></a>
</h5>
<p>The figure created by <code>PowerPlot</code> can only show the
interplay of two variables and power. GridPlot often offers a more
insightful picture, in particular when, as in this example, we have more
than 2 dimensions in our <code>pars</code> argument.</p>
<p>The code below shows how to plot the interplay between n, delta and
sd when the goals is the achieve 90% power.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/GridPlot.html">GridPlot</a></span><span class="op">(</span><span class="va">power</span>,</span>
<span>         target_value <span class="op">=</span> <span class="fl">.9</span>, <span class="co"># you need to choose one target level of power</span></span>
<span>         example <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>delta <span class="op">=</span> <span class="fl">1</span>, sd <span class="op">=</span> <span class="fl">.7</span><span class="op">)</span><span class="op">)</span> <span class="co"># defined by two parameters now.</span></span>
<span><span class="co">#&gt; Warning: At some combinations of `x_par` and `l_par`, no `y_par` was found that</span></span>
<span><span class="co">#&gt; yielded the required target value, which may result in lines ending abruptly.</span></span>
<span><span class="co">#&gt; In most common use cases, you may want to increasing the range of n.</span></span></code></pre></div>
<p><img src="powergrid_files/figure-html/GridPlot-1.png" width="550" style="display: block; margin: auto;"></p>
<p>Note that there are many options in this plot. See the help file of
<code>GridPlot</code> for more info. Importantly, any dimension of the
the <code>power_array</code> in argument x may be mapped to the x- or
y-axis, or to the different lines.</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="ex2">Power evaluation using simulation and resampling<a class="anchor" aria-label="anchor" href="#ex2"></a>
</h3>
<p>Assume we have about the same situation as above, but we do not have
a simple solution to calculate the power: we only have a limited pilot
data set that looks as follows:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pilot_scores</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.1</span>, <span class="fl">4.3</span>, <span class="fl">2.3</span>, <span class="fl">5.2</span>, <span class="fl">1.9</span>, <span class="fl">8.3</span>, <span class="fl">7</span>, <span class="fl">2.6</span>, <span class="fl">2.4</span>, <span class="fl">3.2</span>, <span class="fl">2.1</span>, <span class="fl">2.8</span>, <span class="fl">3.4</span><span class="op">)</span></span></code></pre></div>
<p>Since we do not really understand the distribution (it looks pretty
right-skewed), we plan to perform a Mann-Whitney U-test. We do not want
to simply simulate, but draw from our pilot sample to mimic the
variability and distributional form. We do have an idea about effect
size (somewhere in the range of .5 and 2). The following code my be our
approach to the exploration of power:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sse_pars</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">100</span>, <span class="fl">20</span><span class="op">)</span>,</span>
<span>  delta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">.5</span>, <span class="fl">2</span>, <span class="fl">.2</span><span class="op">)</span><span class="op">)</span> <span class="co"># only effect size</span></span>
<span><span class="va">PowFun</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">delta</span>, <span class="va">pilot_data</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">arm_1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">pilot_data</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">arm_2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">pilot_data</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> <span class="va">delta</span></span>
<span>  <span class="va">significant</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/wilcox.test.html" class="external-link">wilcox.test</a></span><span class="op">(</span><span class="va">arm_1</span>, <span class="va">arm_2</span><span class="op">)</span><span class="op">$</span><span class="va">p.value</span> <span class="op">&lt;</span> <span class="fl">.03</span> <span class="co"># the typical 3% alpha threshold</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">significant</span><span class="op">)</span> <span class="co"># each call of this function gives significant either TRUE</span></span>
<span>                      <span class="co"># or FALSE</span></span>
<span>  <span class="op">}</span></span>
<span><span class="va">power</span> <span class="op">=</span> <span class="fu"><a href="../reference/PowerGrid.html">PowerGrid</a></span><span class="op">(</span>pars <span class="op">=</span> <span class="va">sse_pars</span>,</span>
<span>                  fun <span class="op">=</span> <span class="va">PowFun</span>,</span>
<span>                  more_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pilot_data <span class="op">=</span> <span class="va">pilot_scores</span><span class="op">)</span>, <span class="co"># pass the pilot</span></span>
<span>                                                               <span class="co"># data on to the</span></span>
<span>                                                               <span class="co"># fun argument</span></span>
<span>                  n_iter <span class="op">=</span> <span class="fl">99</span><span class="op">)</span> <span class="co"># we need to iterate over simulated experiemtns</span></span>
<span>                               <span class="co"># to get a power. I would take a higher value</span></span>
<span>                               <span class="co"># than 99; this is to keep the example quick.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">power</span><span class="op">)</span></span>
<span><span class="co">#&gt;  Object of class: power_array</span></span>
<span><span class="co">#&gt; Containing summary over 99 iterations,</span></span>
<span><span class="co">#&gt; summarized by function `summary_function` (for</span></span>
<span><span class="co">#&gt; function definition, see attribute</span></span>
<span><span class="co">#&gt; `summary_function`).</span></span>
<span><span class="co">#&gt;  Range of values: [0.09, 1] </span></span>
<span><span class="co">#&gt;  Evaluated at:</span></span>
<span><span class="co">#&gt;       n 10, 30, 50, 70, 90</span></span>
<span><span class="co">#&gt;   delta 0.5, 0.7, 0.9, 1.1, 1.3, 1.5, 1.7, 1.9</span></span>
<span><span class="fu"><a href="../reference/PowerPlot.html">PowerPlot</a></span><span class="op">(</span><span class="va">power</span><span class="op">)</span></span></code></pre></div>
<p><img src="powergrid_files/figure-html/resample%20MannU-1.png" width="550" style="display: block; margin: auto;"></p>
<p>A couple of notes:</p>
<ul>
<li>The power in the example above is calculated by simulating TRUE’s
and FALSE’s for significance. These were then automatically summarized
by <code>mean</code> to yield the power.</li>
<li>You may want to keep the outcomes of individual iterations of your
function. To do so, set <code>summarize = FALSE</code>. In this
situation, the resulting array will have one additional dimension,
“iter”.</li>
<li>If you choose to keep the individual iterations, be aware that
plotting functions and <code>Example</code> automatically summarize
these taking the mean. You can, however, choose a different
<code>summary_function</code>.</li>
<li>As in PowerPlot, any dimension of the <code>power_array</code> may
be represented by the x-axis, y-axis.</li>
</ul>
</div>
<div class="section level3">
<h3 id="ex3">Target a maximum CI95-width<a class="anchor" aria-label="anchor" href="#ex3"></a>
</h3>
<p>The powergrid package allows to do more than finding a power of at
least some value. Instead, we can target, for example, a 95% confidence
interval that should have at most a certain width. Say, we have the
following situation, where we plan to compare two groups with a t-test
and we want the CI not to be wider than .7 points on our outcome scale.
Maybe, 7 is considered a clinically important difference according to
the literature and when our estimates are not further than .7 points
apart, we can’t really conclude anything. We can use the powergrid
functionality to find the sample size that gives us an expected CI of at
most that value:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CIFun</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">delta</span>, <span class="va">sd</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">x1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="va">sd</span><span class="op">)</span></span>
<span>  <span class="va">x2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="va">delta</span>, sd <span class="op">=</span> <span class="va">sd</span><span class="op">)</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/t.test.html" class="external-link">t.test</a></span><span class="op">(</span><span class="va">x1</span>, <span class="va">x2</span><span class="op">)</span><span class="op">$</span><span class="va">conf.int</span><span class="op">)</span><span class="op">)</span> <span class="co"># return the CI-width</span></span>
<span><span class="op">}</span></span>
<span><span class="va">pars</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> <span class="co"># a normal list</span></span>
<span>  n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">10</span>, to <span class="op">=</span> <span class="fl">60</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>, <span class="co"># sample size</span></span>
<span>  delta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0.5</span>, to <span class="op">=</span> <span class="fl">1.7</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>, <span class="co"># effect size</span></span>
<span>  sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">.5</span>, <span class="fl">1</span>, <span class="fl">.1</span><span class="op">)</span> <span class="co"># variability</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">CI_array</span> <span class="op">=</span> <span class="fu"><a href="../reference/PowerGrid.html">PowerGrid</a></span><span class="op">(</span><span class="va">pars</span>, <span class="va">CIFun</span>, n_iter <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">CI_array</span><span class="op">)</span></span>
<span><span class="co">#&gt;  Object of class: power_array</span></span>
<span><span class="co">#&gt; Containing summary over 20 iterations,</span></span>
<span><span class="co">#&gt; summarized by function `summary_function` (for</span></span>
<span><span class="co">#&gt; function definition, see attribute</span></span>
<span><span class="co">#&gt; `summary_function`).</span></span>
<span><span class="co">#&gt;  Range of values: [0.35, 2.01] </span></span>
<span><span class="co">#&gt;  Evaluated at:</span></span>
<span><span class="co">#&gt;       n 10, 15, 20, 25, 30, 35, 40, 45, 50, 55, 60</span></span>
<span><span class="co">#&gt;   delta 0.5, 0.6, 0.7, 0.8, 0.9, 1, 1.1, 1.2, 1.3, 1.4,</span></span>
<span><span class="co">#&gt;   delta 1.5, 1.6, 1.7</span></span>
<span><span class="co">#&gt;      sd 0.5, 0.6, 0.7, 0.8, 0.9, 1</span></span>
<span><span class="co">## This object now contains, for each parameter combination, the CI-width</span></span>
<span><span class="co">## averaged over 20 iterations.</span></span>
<span></span>
<span><span class="fu"><a href="../reference/Example.html">Example</a></span><span class="op">(</span><span class="va">CI_array</span>,</span>
<span>        example <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>delta <span class="op">=</span> <span class="fl">.7</span>, sd <span class="op">=</span> <span class="fl">.8</span><span class="op">)</span>,</span>
<span>        target_value <span class="op">=</span> <span class="fl">.7</span>,</span>
<span>        target_at_least <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        find_lowest <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; ================================================</span></span>
<span><span class="co">#&gt; To achieve the target value of at most 0.7 assuming</span></span>
<span><span class="co">#&gt; delta = 0.7</span></span>
<span><span class="co">#&gt; sd = 0.8,</span></span>
<span><span class="co">#&gt; the minimal required n = 45</span></span>
<span><span class="co">#&gt; ------------------------------------------------</span></span>
<span><span class="co">#&gt; Description: Method "step" was used to find the</span></span>
<span><span class="co">#&gt; lowest n in the searched grid that yields a</span></span>
<span><span class="co">#&gt; target_value (typically power) of at most 0.7.</span></span>
<span><span class="co">#&gt; ================================================</span></span>
<span><span class="co">## Show results</span></span>
<span><span class="fu"><a href="../reference/PowerPlot.html">PowerPlot</a></span><span class="op">(</span><span class="va">CI_array</span>, slicer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>delta <span class="op">=</span> <span class="fl">.7</span><span class="op">)</span>,</span>
<span>          target_levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.6</span>, <span class="fl">.7</span>, <span class="fl">.8</span><span class="op">)</span>, <span class="co"># this defines the lines</span></span>
<span>          title <span class="op">=</span> <span class="st">"CI-width as a funtion of sd and n,\nassuming delta = .7"</span>,</span>
<span>          shades_of_grey <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># Grey scale is optimized for situation where</span></span>
<span>                                  <span class="co"># the array contains power.</span></span>
<span><span class="fu"><a href="../reference/AddExample.html">AddExample</a></span><span class="op">(</span><span class="va">CI_array</span>,</span>
<span>           slicer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>delta <span class="op">=</span> <span class="fl">.7</span><span class="op">)</span>,</span>
<span>           example <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sd <span class="op">=</span> <span class="fl">.8</span><span class="op">)</span>,</span>
<span>           target_value <span class="op">=</span> <span class="fl">.7</span>,</span>
<span>           target_at_least <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="powergrid_files/figure-html/CI%20example-1.png" width="550" style="display: block; margin: auto;"></p>
<p>A couple of things to observe: * We set “target_at_least” to FALSE,
since we are looking for a CI of <em>at most</em> .7 * The lines in the
figure now connect situations with the same CI-width (not power, as in
the earlier examples) * We changed the title accordingly.</p>
</div>
<div class="section level3">
<h3 id="ex4">Find the upper bound<a class="anchor" aria-label="anchor" href="#ex4"></a>
</h3>
<p>We have the same situation as in the first use case, where we plan a
t-test and aim for a power of 90%. In the current situation, however, we
have a very limited flexibility in the number of participants that we
can recruit. We do have some way of decreasing the variability by
improving our measurements, however. We want to study how small our SD
must be for our study to have desirable power.</p>
<summary in numbers here><ul>
<li>we look for the largest acceptable SD (not the smallest n) where we
can achieve the target value of .7. Therefore, we set
<code>find_lowest = FALSE</code>.</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sse_pars</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">40</span><span class="op">)</span>,</span>
<span>  delta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0.4</span>, to <span class="op">=</span> <span class="fl">1.2</span>, by <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span>, <span class="co">## effect size</span></span>
<span>  sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">.3</span>, <span class="fl">.9</span>, <span class="fl">.01</span><span class="op">)</span><span class="op">)</span> <span class="co">## Standard deviation</span></span>
<span><span class="va">PowFun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">delta</span>, <span class="va">sd</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">ptt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/power.t.test.html" class="external-link">power.t.test</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span><span class="op">/</span><span class="fl">2</span>, delta <span class="op">=</span> <span class="va">delta</span>, sd <span class="op">=</span> <span class="va">sd</span>,</span>
<span>                     sig.level <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">ptt</span><span class="op">$</span><span class="va">power</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">power_array</span> <span class="op">=</span> <span class="fu"><a href="../reference/PowerGrid.html">PowerGrid</a></span><span class="op">(</span>pars <span class="op">=</span> <span class="va">sse_pars</span>, fun <span class="op">=</span> <span class="va">PowFun</span>, n_iter <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/Example.html">Example</a></span><span class="op">(</span><span class="va">power_array</span>,</span>
<span>        example <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">30</span>, delta <span class="op">=</span> <span class="fl">.8</span><span class="op">)</span>,</span>
<span>        find_lowest <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        target_value <span class="op">=</span> <span class="fl">.9</span><span class="op">)</span></span>
<span><span class="co">#&gt; ================================================</span></span>
<span><span class="co">#&gt; To achieve the target value of at most 0.9 assuming</span></span>
<span><span class="co">#&gt; n = 30</span></span>
<span><span class="co">#&gt; delta = 0.8,</span></span>
<span><span class="co">#&gt; maximal permissible sd = 0.65</span></span>
<span><span class="co">#&gt; ------------------------------------------------</span></span>
<span><span class="co">#&gt; Description: Method "step" was used to find the</span></span>
<span><span class="co">#&gt; highest sd in the searched grid that yields a</span></span>
<span><span class="co">#&gt; target_value (typically power) of at least 0.9.</span></span>
<span><span class="co">#&gt; ================================================</span></span></code></pre></div>
<p>We see that, by setting <code>find_lowest = FALSE</code> Example()
shows us the “maximal permissible” value that sd may take in order to
achieve the set target.</p>
<p>Below, inspect the situation in graphic form. Note that the argument
<code>par_to_search</code> is set to “sd”, putting that parameter on the
y-axis.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/PowerPlot.html">PowerPlot</a></span><span class="op">(</span><span class="va">power_array</span>,</span>
<span>          slicer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,</span>
<span>          par_to_search <span class="op">=</span> <span class="st">'sd'</span>,</span>
<span>          example <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>delta <span class="op">=</span> <span class="fl">.8</span><span class="op">)</span>,</span>
<span>          find_lowest <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>          target_value <span class="op">=</span> <span class="fl">.9</span><span class="op">)</span></span></code></pre></div>
<p><img src="powergrid_files/figure-html/maximum%20SD%20PowerPlot-1.png" width="550" style="display: block; margin: auto;"></p>
</summary>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Gilles Dutilh, Richard Charles Allen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
